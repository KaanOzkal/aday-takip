<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>CV | <%= user.firstName %> <%= user.lastName %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: <%= user.cvDetails?.cvColor || '#0f172a' %>;
            --sidebar-bg: var(--primary-color);
            --sidebar-text: #ffffff;
            --main-bg: #ffffff;
            --text-dark: #1e293b;
            --text-muted: #64748b;
            --border-light: #e2e8f0;
        }

        * { box-sizing: border-box; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        body { background: #e2e8f0; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 40px 0; display: flex; justify-content: center; min-height: 100vh; }
        .page { background: var(--main-bg); width: 210mm; min-height: 297mm; display: flex; box-shadow: 0 15px 35px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
        
        /* SOL SÜTUN */
        .sidebar { width: 33%; background: var(--sidebar-bg); color: var(--sidebar-text); padding: 40px 25px; display: flex; flex-direction: column; position: relative; }
        .sidebar::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.1) 100%); pointer-events: none; }
        
        .profile-container { width: 140px; height: 140px; margin: 0 auto 30px auto; position: relative; z-index: 2; }
        .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid rgba(255,255,255,0.3); }
        .profile-placeholder { width: 100%; height: 100%; border-radius: 50%; background: rgba(255,255,255,0.15); color: white; display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: 700; border: 4px solid rgba(255,255,255,0.3); }

        .sidebar-heading { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; font-weight: 800; color: rgba(255,255,255,0.7); border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 8px; margin: 30px 0 15px 0; position: relative; z-index: 2; }
        .contact-item { display: flex; align-items: flex-start; gap: 12px; font-size: 12px; color: rgba(255,255,255,0.9); line-height: 1.4; margin-bottom: 12px; position: relative; z-index: 2; }
        .contact-icon { width: 24px; height: 24px; background: rgba(255,255,255,0.15); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; flex-shrink: 0; }
        
        .skill-container { display: flex; flex-wrap: wrap; gap: 6px; position: relative; z-index: 2; }
        .skill-tag { background: rgba(255,255,255,0.15); color: white; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 500; }

        .sidebar-footer { margin-top: auto; text-align: center; padding-top: 30px; position: relative; z-index: 2; }
        .brand-logo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; background: white; padding: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: inline-block; }
        .brand-text { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; font-weight: 600; }

        /* SAĞ SÜTUN */
        .main-content { width: 67%; padding: 50px 40px; color: var(--text-dark); }
        .header-section { margin-bottom: 35px; border-bottom: 2px solid var(--border-light); padding-bottom: 20px; }
        .full-name { font-size: 38px; font-weight: 800; text-transform: uppercase; line-height: 1; color: var(--primary-color); margin-bottom: 5px; }
        .job-title { font-size: 16px; text-transform: uppercase; letter-spacing: 3px; color: var(--text-muted); font-weight: 600; }
        .summary-box { font-size: 13px; line-height: 1.6; color: var(--text-dark); margin-bottom: 30px; text-align: justify; }

        .section-title { font-size: 16px; font-weight: 700; text-transform: uppercase; color: var(--primary-color); display: flex; align-items: center; gap: 10px; margin-bottom: 20px; padding-bottom: 8px; border-bottom: 1px solid var(--border-light); margin-top: 30px; }
        .section-title i { background: var(--primary-color); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }

        .timeline-container { border-left: 2px solid var(--border-light); padding-left: 20px; margin-left: 14px; }
        .timeline-item { position: relative; margin-bottom: 25px; }
        .timeline-dot { position: absolute; left: -27px; top: 4px; width: 12px; height: 12px; background: white; border: 3px solid var(--primary-color); border-radius: 50%; }
        .item-title { font-size: 15px; font-weight: 700; color: var(--text-dark); }
        .item-subtitle { font-size: 13px; font-weight: 600; color: var(--primary-color); }
        .item-meta { font-size: 11px; color: var(--text-muted); font-style: italic; margin-bottom: 5px; }
        .item-desc { font-size: 12px; line-height: 1.5; color: #475569; white-space: pre-line; }

        /* Yazdırma Butonları */
        .print-actions { position: fixed; bottom: 30px; right: 30px; display: flex; gap: 10px; z-index: 9999; }
        .btn-action { background: var(--text-dark); color: white; padding: 12px 25px; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 14px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-action.primary { background: var(--primary-color); }

        @media print {
            body { background: white; padding: 0; margin: 0; }
            .page { width: 100%; height: auto; box-shadow: none; margin: 0; }
            .print-actions { display: none !important; }
            .sidebar { -webkit-print-color-adjust: exact; background-color: var(--primary-color) !important; }
        }
    </style>
</head>
<body>

    <div class="print-actions">
        <button onclick="window.print()" class="btn-action primary"><i class="fas fa-print"></i> Yazdır / PDF</button>
        <button onclick="window.close()" class="btn-action"><i class="fas fa-times"></i> Kapat</button>
    </div>

    <div class="page">
        <div class="sidebar">
            <div class="profile-container">
                <% if(user.cvDetails?.profilePhoto) { %>
                    <img src="<%= user.cvDetails.profilePhoto %>" class="profile-img">
                <% } else { %>
                    <div class="profile-placeholder"><%= user.firstName.charAt(0) %></div>
                <% } %>
            </div>

            <div class="sidebar-heading">KİŞİSEL BİLGİLER</div>
            <div class="contact-list">
                <% if(user.cvDetails?.birthDate) { %>
                    <div class="contact-item"><div class="contact-icon"><i class="fas fa-birthday-cake"></i></div> <div><%= new Date(user.cvDetails.birthDate).toLocaleDateString('tr-TR') %></div></div>
                <% } %>
                <div class="contact-item"><div class="contact-icon"><i class="fas fa-map-marker-alt"></i></div> <div><%= user.cvDetails?.address || user.location %></div></div>
                <div class="contact-item"><div class="contact-icon"><i class="fas fa-phone"></i></div> <div><%= user.cvDetails?.phone || user.phone %></div></div>
                <div class="contact-item"><div class="contact-icon"><i class="fas fa-envelope"></i></div> <div style="font-size:11px; word-break:break-all;"><%= user.cvDetails?.email || user.email %></div></div>
                
                <% if(user.cvDetails?.drivingLicense) { %>
                    <div class="contact-item"><div class="contact-icon"><i class="fas fa-car"></i></div> <div>Ehliyet: <%= user.cvDetails.drivingLicense %></div></div>
                <% } %>
                
                <% if(user.cvDetails?.linkedin) { %>
                    <div class="contact-item"><div class="contact-icon"><i class="fab fa-linkedin-in"></i></div> <div><a href="<%= user.cvDetails.linkedin %>" target="_blank">LinkedIn Profil</a></div></div>
                <% } %>
            </div>

            <div class="sidebar-heading">DİLLER</div>
            <div class="skill-container">
                <% if(user.cvDetails?.languages) { %>
                    <% let langs = Array.isArray(user.cvDetails.languages) ? user.cvDetails.languages : user.cvDetails.languages.split(','); %>
                    <% langs.forEach(lang => { if(lang.trim()){ %> <span class="skill-tag"><%= lang.trim() %></span> <% } }) %>
                <% } %>
            </div>

            <div class="sidebar-heading">YETENEKLER</div>
            <div class="skill-container">
                <% if(user.cvDetails?.skills) { %>
                    <% user.cvDetails.skills.split(/\r?\n|,/).forEach(skill => { if(skill.trim()) { %>
                        <span class="skill-tag"><%= skill.trim() %></span>
                    <% } }) %>
                <% } %>
            </div>

            <% if(user.cvDetails?.softSkills) { %>
                <div class="sidebar-heading">SOSYAL BECERİLER</div>
                <div class="skill-container">
                    <% user.cvDetails.softSkills.split(',').forEach(skill => { if(skill.trim()) { %>
                        <span class="skill-tag"><%= skill.trim() %></span>
                    <% } }) %>
                </div>
            <% } %>

            <div class="sidebar-footer">
                <img src="/images/BERLINERLOGO.webp" class="brand-logo" onerror="this.style.display='none'">
                <div class="brand-text">POWERED BY BERLINER AKADEMIE</div>
            </div>
        </div>

        <div class="main-content">
            <div class="header-section">
                <div class="full-name"><%= user.firstName %> <%= user.lastName %></div>
                <div class="job-title"><%= user.cvDetails?.experience1?.title || 'ADAY' %></div>
            </div>

            <% if(user.cvDetails?.summary) { %>
                <div class="section-title"><i class="fas fa-user"></i> Profesyonel Özet</div>
                <div class="summary-box"><%= user.cvDetails.summary %></div>
            <% } %>

            <div class="section-title"><i class="fas fa-briefcase"></i> İş Deneyimi</div>
            <div class="timeline-container">
                <% if(user.cvDetails?.experience1?.title) { %>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="item-title"><%= user.cvDetails.experience1.title %></div>
                        <div class="item-subtitle"><%= user.cvDetails.experience1.company %></div>
                        <div class="item-meta"><%= user.cvDetails.experience1.date %> | <%= user.cvDetails.experience1.location %></div>
                        <div class="item-desc"><%= user.cvDetails.experience1.desc %></div>
                    </div>
                <% } %>
                <% if(user.cvDetails?.experience2?.title) { %>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="item-title"><%= user.cvDetails.experience2.title %></div>
                        <div class="item-subtitle"><%= user.cvDetails.experience2.company %></div>
                        <div class="item-meta"><%= user.cvDetails.experience2.date %> | <%= user.cvDetails.experience2.location %></div>
                        <div class="item-desc"><%= user.cvDetails.experience2.desc %></div>
                    </div>
                <% } %>

                <% 
                    let addTitles = user.cvDetails?.exp_additional_title;
                    // Eğer string ise diziye çevir, eğer dizi ise olduğu gibi al, eğer yoksa boş dizi yap
                    let titlesArray = Array.isArray(addTitles) ? addTitles : (addTitles ? [addTitles] : []);
                    
                    let addCompanies = Array.isArray(user.cvDetails?.exp_additional_company) ? user.cvDetails.exp_additional_company : [user.cvDetails?.exp_additional_company];
                    let addDates = Array.isArray(user.cvDetails?.exp_additional_date) ? user.cvDetails.exp_additional_date : [user.cvDetails?.exp_additional_date];
                    let addDescs = Array.isArray(user.cvDetails?.exp_additional_desc) ? user.cvDetails.exp_additional_desc : [user.cvDetails?.exp_additional_desc];
                %>

                <% titlesArray.forEach((title, i) => { if(title) { %>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="item-title"><%= title %></div>
                        <div class="item-subtitle"><%= addCompanies[i] || '' %></div>
                        <div class="item-meta"><%= addDates[i] || '' %></div>
                        <div class="item-desc"><%= addDescs[i] || '' %></div>
                    </div>
                <% } }) %>
            </div>

            <div class="section-title" style="margin-top: 30px;"><i class="fas fa-graduation-cap"></i> Eğitim</div>
            <div class="timeline-container">
                <% if(user.cvDetails?.education1?.school) { %>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="item-title"><%= user.cvDetails.education1.school %></div>
                        <div class="item-subtitle"><%= user.cvDetails.education1.degree %></div>
                        <div class="item-meta"><%= user.cvDetails.education1.date %> | <%= user.cvDetails.education1.location %></div>
                        <div class="item-desc"><%= user.cvDetails.education1.achievements %></div>
                    </div>
                <% } %>

                <% 
                    let eduSchools = user.cvDetails?.edu_additional_school;
                    let eduSchoolsArray = Array.isArray(eduSchools) ? eduSchools : (eduSchools ? [eduSchools] : []);
                    let eduDegrees = Array.isArray(user.cvDetails?.edu_additional_degree) ? user.cvDetails.edu_additional_degree : [user.cvDetails?.edu_additional_degree];
                    let eduDates = Array.isArray(user.cvDetails?.edu_additional_date) ? user.cvDetails.edu_additional_date : [user.cvDetails?.edu_additional_date];
                %>
                <% eduSchoolsArray.forEach((school, i) => { if(school) { %>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="item-title"><%= school %></div>
                        <div class="item-subtitle"><%= eduDegrees[i] || '' %></div>
                        <div class="item-meta"><%= eduDates[i] || '' %></div>
                    </div>
                <% } }) %>
            </div>

            <div style="display: flex; gap: 30px; margin-top: 30px;">
                
                <% if(user.cvDetails?.certificate1 || user.cvDetails?.cert_additional_name) { %>
                    <div style="flex: 1;">
                        <div class="section-title" style="margin-top: 0;"><i class="fas fa-award"></i> Sertifikalar</div>
                        <div class="timeline-container" style="border: none; padding-left: 0;">
                            <% if(user.cvDetails?.certificate1) { %>
                                <div class="timeline-item" style="margin-bottom: 15px;">
                                    <div class="item-title" style="font-size: 13px;"><%= user.cvDetails.certificate1 %></div>
                                    <div class="item-meta"><%= user.cvDetails.certificate1_issuer %></div>
                                </div>
                            <% } %>
                            <% 
                                let certNames = user.cvDetails?.cert_additional_name;
                                let certArray = Array.isArray(certNames) ? certNames : (certNames ? [certNames] : []);
                                let certIssuers = Array.isArray(user.cvDetails?.cert_additional_issuer) ? user.cvDetails.cert_additional_issuer : [user.cvDetails?.cert_additional_issuer];
                            %>
                            <% certArray.forEach((cert, i) => { if(cert) { %>
                                <div class="timeline-item" style="margin-bottom: 15px;">
                                    <div class="item-title" style="font-size: 13px;"><%= cert %></div>
                                    <div class="item-meta"><%= certIssuers[i] || '' %></div>
                                </div>
                            <% } }) %>
                        </div>
                    </div>
                <% } %>

                <% if(user.cvDetails?.reference1_name) { %>
                    <div style="flex: 1;">
                        <div class="section-title" style="margin-top: 0;"><i class="fas fa-handshake"></i> Referanslar</div>
                        <div style="font-size: 13px;">
                            <strong><%= user.cvDetails.reference1_name %></strong><br>
                            <%= user.cvDetails.reference1_position %><br>
                            <span style="color:var(--text-muted)"><%= user.cvDetails.reference1_company %></span><br>
                            <span style="color:var(--primary-color); font-size:11px;"><%= user.cvDetails.reference1_contact %></span>
                        </div>
                    </div>
                <% } %>
            </div>

        </div>
    </div>

</body>
</html>