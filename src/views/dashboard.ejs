<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aday Paneli | Almanya Kariyer</title>
    
    <% const targetStateInfo = locals.targetStateInfo || null; %>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        body { background-color: #f8fafc; font-family: 'Plus Jakarta Sans', sans-serif; color: #334155; }

        /* Sidebar & Layout */
        .sidebar { min-height: 100vh; background: white; border-right: 1px solid #e2e8f0; }
        .nav-link, .menu-text { color: #64748b; font-weight: 500; padding: 0.75rem 1rem; border-radius: 10px; margin-bottom: 0.25rem; transition: all 0.2s; display: block; text-decoration: none; }
        .nav-link:hover, .nav-link.active, .menu-text:hover, .menu-text.active { background-color: #f1f5f9; color: #0f172a; }
        .nav-link.active, .menu-text.active { background-color: #e0f2fe; color: #0284c7; }
        .nav-link i, .menu-text i { width: 24px; text-align: center; margin-right: 8px; }

        /* Kartlar */
        .welcome-card {
            background: linear-gradient(135deg, #4f46e5 0%, #312e81 100%);
            color: white; border-radius: 20px; padding: 2.5rem; position: relative; overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.2);
        }
        .welcome-card::after {
            content: ''; position: absolute; top: 0; right: 0; bottom: 0; left: 0;
            background-image: url('https://www.transparenttextures.com/patterns/cubes.png'); opacity: 0.1;
        }

        /* HEDEF EYALET KARTI */
        .target-state-card {
            background: white; border: 1px solid #e2e8f0; border-radius: 20px;
            padding: 0; overflow: hidden; position: relative;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; height: 100%;
        }
        .state-header {
            background: linear-gradient(135deg, #FFCE00, #F59E0B); /* Alman SarÄ±sÄ± */
            padding: 1.5rem; color: #000; position: relative;
        }
        .state-content { padding: 1.5rem; flex-grow: 1; }
        .state-weather-box {
            background: #f8fafc; border-radius: 12px; padding: 1rem;
            text-align: center; border: 1px solid #e2e8f0;
        }

        /* Stat Cards */
        .stat-card {
            background: white; border-radius: 16px; padding: 1.5rem;
            border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: transform 0.2s; height: 100%;
        }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .icon-box {
            width: 48px; height: 48px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; margin-bottom: 1rem;
        }

        /* Weather Cards */
        .weather-card {
            background: linear-gradient(to bottom right, #ffffff, #f8fafc);
            border: 1px solid #e2e8f0; border-radius: 16px; padding: 1.25rem;
            text-align: center; transition: transform 0.2s; height: 100%;
        }
        .weather-card:hover { transform: translateY(-5px); border-color: #cbd5e1; }
        .weather-temp { font-size: 2rem; font-weight: 800; color: #1e293b; margin: 0.5rem 0; line-height: 1; }
        .weather-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .weather-city { font-weight: 700; color: #64748b; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; }
        .weather-desc { font-size: 0.85rem; color: #94a3b8; }

        /* Timeline */
        .timeline-wrapper { position: relative; padding-left: 10px; }
        .timeline-item { position: relative; padding-bottom: 2rem; border-left: 2px solid #e2e8f0; padding-left: 25px; }
        .timeline-item:last-child { border-left: transparent; }
        .timeline-marker {
            position: absolute; left: -11px; top: 0; width: 20px; height: 20px;
            border-radius: 50%; background: white; border: 4px solid #cbd5e1; z-index: 1;
        }
        .timeline-item.active .timeline-marker { border-color: #4f46e5; box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2); }
        .timeline-item.completed .timeline-marker { border-color: #10b981; background: #10b981; }
        .timeline-item.completed { border-left-color: #10b981; }
        
        .word-card { background: #1e293b; color: white; border-radius: 16px; overflow: hidden; position: relative; }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark bg-dark d-lg-none sticky-top shadow-sm">
        <div class="container-fluid">
            <span class="navbar-brand fw-bold"><i class="fas fa-flag me-2"></i>BERLINER</span>
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            
            <div class="col-lg-2 d-none d-lg-block sidebar p-4 sticky-top">
                <div class="d-flex align-items-center gap-2 mb-5">
                    <div class="bg-primary text-white rounded p-2"><i class="fas fa-flag"></i></div>
                    <span class="fw-bold fs-5 text-dark">BERLINER</span>
                </div>
                
                <nav class="nav flex-column gap-1">
                    <a href="/panel" class="nav-link active"><i class="fas fa-home"></i> Ana Sayfa</a>
                    <a href="/profile" class="nav-link"><i class="fas fa-user-circle"></i> Profilim</a>
                    <a href="/processes" class="nav-link"><i class="fas fa-tasks"></i> SÃ¼reÃ§ler</a>
                    <a href="/documents" class="nav-link"><i class="fas fa-file-alt"></i> DokÃ¼manlar</a>
                    
                    <a href="/messages" class="nav-link d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-comments"></i> Mesajlar</span>
                        <% if (locals.unreadCount && locals.unreadCount > 0) { %>
                            <span class="badge bg-danger rounded-pill animate__animated animate__pulse animate__infinite">
                                <%= unreadCount %>
                            </span>
                        <% } %>
                    </a>
                    <a href="/life-in-germany" class="nav-link <%= page === 'life_germany' ? 'active' : '' %>">
    <i class="fas fa-city"></i> Almanya'da Hayat
</a>
                    <a href="/cv-builder" class="nav-link"><i class="fas fa-file-contract"></i> AkÄ±llÄ± CV oluÅŸturucu </a>
                    <a href="/application-form" class="nav-link"><i class="fas fa-file-signature"></i>Form</a>
                    <a href="/german" class="nav-link"><i class="fas fa-graduation-cap"></i> Almanca</a>
                    <a href="/appointments" class="nav-link"><i class="fas fa-calendar-alt"></i> Randevular</a>
                    <a href="/settings" class="nav-link"><i class="fas fa-cog"></i> Ayarlar</a>
                    <a href="/game" class="menu-text">
                        <i class="fas fa-gamepad"></i> <span class="menu-text p-0">Oyun AlanÄ±</span>
                    </a>
                    <hr>
                    <a href="/logout" class="nav-link text-danger"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ Yap</a>
                </nav>
            </div>

            <div class="col-12 col-lg-10 p-4">
                
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="d-none d-md-block">
                        <h4 class="fw-bold mb-0">Panel</h4>
                        <small class="text-muted"><%= new Date().toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></small>
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        <div class="bg-white p-2 rounded-circle shadow-sm border d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                            <i class="fas fa-bell text-secondary"></i>
                        </div>
                        <div class="d-flex align-items-center gap-2 bg-white px-3 py-2 rounded-pill shadow-sm border">
                            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <%= user.firstName.charAt(0) %><%= user.lastName.charAt(0) %>
                            </div>
                            <span class="fw-bold small d-none d-sm-inline"><%= user.firstName %> <%= user.lastName %></span>
                        </div>
                    </div>
                </div>

                <div class="welcome-card mb-4">
                    <div class="row align-items-center position-relative" style="z-index: 2;">
                        <div class="col-lg-8">
                            <h2 class="fw-bold mb-2">HoÅŸgeldin, <%= user.firstName %>! ðŸ‘‹</h2>
                            <p class="mb-0 opacity-75">Almanya kariyer yolculuÄŸunda seninle birlikteyiz. SÃ¼reÃ§lerin ÅŸu an normal ilerliyor.</p>
                        </div>
                        <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                            <div class="d-inline-block bg-white bg-opacity-10 p-3 rounded-3 border border-white border-opacity-10 text-center">
                                <small class="text-uppercase fw-bold opacity-75" style="font-size: 0.7rem;">Profil UygunluÄŸu</small>
                                <div class="display-6 fw-bold"><%= user.score %>%</div>
                            </div>
                        </div>
                    </div>
                </div>
                

                <div class="mb-4">
                    <% if(targetStateInfo) { %>
                        <div class="target-state-card">
                            <div class="state-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="small text-uppercase fw-bold opacity-75" style="letter-spacing: 1px;">HEDEFÄ°NÄ°Z</div>
                                        <h3 class="fw-bold mb-0 text-dark"><i class="fas fa-map-marker-alt me-2"></i><%= user.targetState %></h3>
                                    </div>
                                    <div style="font-size: 3rem; opacity: 0.2;"><i class="fas fa-city"></i></div>
                                </div>
                            </div>
                            <div class="state-content">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h6 class="fw-bold text-dark">BÃ¶lge HakkÄ±nda</h6>
                                        <p class="text-secondary mb-0"><%= targetStateInfo.desc %></p>
                                    </div>
                                    <div class="col-md-4 mt-3 mt-md-0">
                                        <div class="state-weather-box" id="target-state-weather">
                                            <div class="d-flex align-items-center justify-content-center gap-3">
                                                <div class="weather-icon text-primary mb-0" style="font-size: 2rem;">
                                                    <i class="fas fa-spinner fa-spin"></i>
                                                </div>
                                                <div class="text-start">
                                                    <div class="weather-temp fs-3 mb-0">--Â°</div>
                                                    <div class="weather-desc small text-muted">YÃ¼kleniyor...</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% } else { %>
                        <div class="card border-0 shadow-sm p-4" style="background: #fffbeb; border-left: 5px solid #f59e0b !important;">
                            <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-warning bg-opacity-25 text-warning p-3 rounded-circle">
                                        <i class="fas fa-map-marked-alt fa-2x"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold text-dark mb-1">HenÃ¼z Bir Hedef SeÃ§mediniz!</h5>
                                        <p class="text-muted mb-0 small">Almanya'da gitmek istediÄŸiniz eyaleti seÃ§iniz</p>
                                    </div>
                                </div>
                                <a href="/profile" class="btn btn-warning text-dark fw-bold rounded-pill px-4">
                                    Hemen SeÃ§im Yap <i class="fas fa-arrow-right ms-2"></i>
                                </a>
                            </div>
                        </div>
                    <% } %>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-12"><h6 class="fw-bold text-dark mb-0 ps-1 small text-uppercase text-muted">PopÃ¼ler Åžehirlerde Hava Durumu</h6></div>
                    
                    <div class="col-6 col-md-4 col-xl-2">
                        <div class="weather-card" id="weather-berlin">
                            <div class="weather-city">Berlin</div>
                            <div class="weather-icon text-warning"><i class="fas fa-spinner fa-spin"></i></div>
                            <div class="weather-temp">--Â°</div>
                            <div class="weather-desc">YÃ¼kleniyor...</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-xl-2">
                        <div class="weather-card" id="weather-hamburg">
                            <div class="weather-city">Hamburg</div>
                            <div class="weather-icon text-primary"><i class="fas fa-spinner fa-spin"></i></div>
                            <div class="weather-temp">--Â°</div>
                            <div class="weather-desc">YÃ¼kleniyor...</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-xl-2">
                        <div class="weather-card" id="weather-kiel">
                            <div class="weather-city">Kiel</div>
                            <div class="weather-icon text-info"><i class="fas fa-spinner fa-spin"></i></div>
                            <div class="weather-temp">--Â°</div>
                            <div class="weather-desc">YÃ¼kleniyor...</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-xl-2">
                        <div class="weather-card" id="weather-hannover">
                            <div class="weather-city">Hannover</div>
                            <div class="weather-icon text-secondary"><i class="fas fa-spinner fa-spin"></i></div>
                            <div class="weather-temp">--Â°</div>
                            <div class="weather-desc">YÃ¼kleniyor...</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-xl-2">
                        <div class="weather-card" id="weather-dortmund">
                            <div class="weather-city">Dortmund</div>
                            <div class="weather-icon text-success"><i class="fas fa-spinner fa-spin"></i></div>
                            <div class="weather-temp">--Â°</div>
                            <div class="weather-desc">YÃ¼kleniyor...</div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 col-xl-2">
                        <div class="weather-card" id="weather-gelsenkirchen">
                            <div class="weather-city">Gelsenkirchen</div>
                            <div class="weather-icon text-info"><i class="fas fa-spinner fa-spin"></i></div>
                            <div class="weather-temp">--Â°</div>
                            <div class="weather-desc">YÃ¼kleniyor...</div>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm mb-4 overflow-hidden">
                    <div class="card-body p-0">
                        <div class="d-flex flex-column flex-md-row align-items-center">
                            
                            <div class="bg-primary bg-opacity-10 p-4 d-flex align-items-center justify-content-center w-100 w-md-auto" 
                                 style="min-width: 120px; min-height: 100px;">
                                <i class="fas fa-file-pdf fa-3x text-primary"></i>
                            </div>

                            <div class="p-4 flex-grow-1 text-center text-md-start">
                                <h5 class="fw-bold text-dark mb-2">
                                    ðŸ‡©ðŸ‡ª Lojistik Bilgilendirme KÄ±lavuzu
                                </h5>
                                <p class="text-muted mb-0 small">
                                    Almanya'daki lojistik sÃ¼reÃ§leri, Ã§alÄ±ÅŸma koÅŸullarÄ± ve vize adÄ±mlarÄ± hakkÄ±nda 
                                    bilmeniz gereken her ÅŸey bu dosyada. LÃ¼tfen indirip dikkatlice okuyunuz.
                                </p>
                            </div>

                            <div class="p-4 w-100 w-md-auto text-center">
                                <a href="/100_26_LOJISTIK_BILGILENDIRME.pdf" download class="btn btn-primary fw-bold px-4 py-2 rounded-pill shadow-sm w-100 w-md-auto">
                                    <i class="fas fa-download me-2"></i> <span class="d-md-none">DosyayÄ± </span>Ä°ndir
                                </a>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-6 col-md-3">
                        <div class="stat-card">
                            <div class="icon-box bg-primary bg-opacity-10 text-primary"><i class="fas fa-file-alt"></i></div>
                            <h6 class="text-muted small fw-bold">YÃœKLENEN</h6>
                            <h3 class="fw-bold mb-0"><%= user.documents.length %></h3>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card">
                            <div class="icon-box bg-warning bg-opacity-10 text-warning"><i class="fas fa-envelope"></i></div>
                            <h6 class="text-muted small fw-bold">MESAJLAR</h6>
                            <h3 class="fw-bold mb-0"><%= messages.length %></h3>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card">
                            <div class="icon-box bg-success bg-opacity-10 text-success"><i class="fas fa-check-circle"></i></div>
                            <h6 class="text-muted small fw-bold">ONAYLI</h6>
                            <h3 class="fw-bold mb-0"><%= user.documents.filter(d => d.status === 'OnaylandÄ±').length %></h3>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-card">
                            <div class="icon-box bg-info bg-opacity-10 text-info"><i class="fas fa-calendar-check"></i></div>
                            <h6 class="text-muted small fw-bold">GÃœNCEL</h6>
                            <h5 class="fw-bold mb-0 fs-6">BugÃ¼n</h5>
                        </div>
                    </div>
                </div>

                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm rounded-4 h-100">
                            <div class="card-header bg-white border-0 pt-4 px-4 pb-0 d-flex justify-content-between align-items-center">
                                <h5 class="fw-bold text-dark mb-0"><i class="fas fa-stream text-primary me-2"></i> SÃ¼reÃ§ Durumu</h5>
                                <a href="/processes" class="btn btn-sm btn-light rounded-pill">DetaylÄ± GÃ¶r</a>
                            </div>
                            <div class="card-body p-4">
                                
                                <div class="mb-4">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-muted small fw-bold">GENEL Ä°LERLEME</span>
                                        <span class="badge bg-primary rounded-pill">%<%= typeof progress !== 'undefined' ? progress : 0 %> TamamlandÄ±</span>
                                    </div>
                                    <div class="progress" style="height: 20px; background-color: #f1f5f9; border-radius: 10px;">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-gradient-primary" 
                                             role="progressbar" 
                                             style="width: <%= typeof progress !== 'undefined' ? progress : 0 %>%; border-radius: 10px;" 
                                             aria-valuenow="<%= typeof progress !== 'undefined' ? progress : 0 %>" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                        </div>
                                    </div>
                                    <p class="text-center mt-2 small text-muted">
                                        Åžu anki aÅŸama: <strong class="text-primary"><%= user.currentStage %></strong>
                                    </p>
                                </div>
                                <hr class="my-4 border-light">

                                <div class="timeline-wrapper">
                                    <% 
                                        const currentIndex = stages.indexOf(user.currentStage);
                                        stages.forEach((stage, index) => { 
                                            let statusClass = '';
                                            if (index < currentIndex) statusClass = 'completed';
                                            else if (index === currentIndex) statusClass = 'active';
                                    %>
                                        <div class="timeline-item <%= statusClass %>">
                                            <div class="timeline-marker"></div>
                                            <div class="ps-2">
                                                <h6 class="fw-bold mb-1 <%= statusClass === 'active' ? 'text-primary' : 'text-dark' %>">
                                                    <%= stage %>
                                                    <% if(statusClass === 'active') { %>
                                                        <span class="badge bg-primary bg-opacity-10 text-primary ms-2">Åžu Anki AÅŸama</span>
                                                    <% } else if(statusClass === 'completed') { %>
                                                        <i class="fas fa-check text-success ms-2 small"></i>
                                                    <% } %>
                                                </h6>
                                                <% if(statusClass === 'active') { %>
                                                    <p class="small text-muted mb-0">DosyanÄ±z ÅŸu anda bu aÅŸamada iÅŸlem gÃ¶rÃ¼yor. LÃ¼tfen bildirimleri takip edin.</p>
                                                <% } %>
                                            </div>
                                        </div>
                                    <% }) %>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="word-card p-4 mb-4 shadow-sm text-center">
                            <div style="position: absolute; top: -10px; right: -10px; font-size: 5rem; opacity: 0.1;"><i class="fas fa-quote-right"></i></div>
                            <span class="badge bg-warning text-dark mb-3">GÃ¼nÃ¼n Kelimesi</span>
                            <% if(typeof dailyWords !== 'undefined' && dailyWords.length > 0) { %>
                                <h2 class="fw-bold text-warning mb-1"><%= dailyWords[0].german %></h2>
                                <h5 class="fw-light mb-3 text-white-50"><%= dailyWords[0].turkish %></h5>
                                <a href="/german" class="btn btn-outline-light btn-sm rounded-pill w-100">Daha Fazla Ã‡alÄ±ÅŸ</a>
                            <% } else { %>
                                <p>Kelime yÃ¼kleniyor...</p>
                            <% } %>
                        </div>

                        <div class="card border-0 shadow-sm rounded-4">
                            <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                                <h6 class="fw-bold text-dark mb-0">Son Bildirimler</h6>
                            </div>
                            <div class="card-body p-3">
                                <% if(messages.length > 0) { %>
                                    <div class="list-group list-group-flush">
                                        <% messages.slice(0, 3).forEach(msg => { %>
                                            <a href="/messages" class="list-group-item list-group-item-action border-0 rounded-3 mb-1 p-2 d-flex gap-3 align-items-start">
                                                <div class="bg-light p-2 rounded-circle text-primary"><i class="fas fa-envelope"></i></div>
                                                <div>
                                                    <div class="d-flex justify-content-between w-100">
                                                        <small class="fw-bold text-dark">DanÄ±ÅŸman</small>
                                                        <small class="text-muted" style="font-size: 0.7rem;"><%= new Date(msg.date).toLocaleDateString() %></small>
                                                    </div>
                                                    <p class="mb-0 text-muted small text-truncate" style="max-width: 200px;"><%= msg.content %></p>
                                                </div>
                                            </a>
                                        <% }) %>
                                    </div>
                                <% } else { %>
                                    <div class="text-center py-4 text-muted small">
                                        OkunmamÄ±ÅŸ mesajÄ±nÄ±z yok.
                                    </div>
                                <% } %>
                                <a href="/messages" class="btn btn-light w-100 mt-2 btn-sm text-muted">TÃ¼mÃ¼nÃ¼ GÃ¶r</a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileSidebar">
        <div class="offcanvas-header bg-dark text-white">
            <h5 class="offcanvas-title">MenÃ¼</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <nav class="nav flex-column gap-2">
                <a href="/panel" class="nav-link active"><i class="fas fa-home"></i> Ana Sayfa</a>
                <a href="/profile" class="nav-link"><i class="fas fa-user-circle"></i> Profilim</a>
                <a href="/processes" class="nav-link"><i class="fas fa-tasks"></i> SÃ¼reÃ§ler</a>
                <a href="/documents" class="nav-link"><i class="fas fa-file-alt"></i> DokÃ¼manlar</a>
                
                <a href="/messages" class="nav-link d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-comments me-2"></i> Mesajlar</span>
                    <% if (locals.unreadCount && locals.unreadCount > 0) { %>
                        <span class="badge bg-danger rounded-pill animate__animated animate__pulse animate__infinite">
                            <%= unreadCount %>
                        </span>
                    <% } %>
                </a>
                <a href="/life-in-germany" class="nav-link <%= page === 'life_germany' ? 'active' : '' %>">
    <i class="fas fa-city"></i> Almanya'da Hayat
</a>
                <a href="/cv-builder" class="nav-link"><i class="fas fa-file-contract"></i> AkÄ±llÄ± CV oluÅŸturucu </a>
                <a href="/application-form" class="nav-link"><i class="fas fa-file-signature"></i>Form</a>
                <a href="/german" class="nav-link"><i class="fas fa-graduation-cap"></i> Almanca</a>
                <a href="/appointments" class="nav-link"><i class="fas fa-calendar-alt"></i> Randevular</a>
                <a href="/settings" class="nav-link"><i class="fas fa-cog"></i> Ayarlar</a>
                <a href="/game" class="menu-text">
                    <i class="fas fa-gamepad"></i> <span class="menu-text p-0">Oyun AlanÄ±</span>
                </a>
                <hr>
                <a href="/logout" class="nav-link text-danger"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ Yap</a>
            </nav>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // Login UyarÄ±sÄ±
            const urlParams = new URLSearchParams(window.location.search);
            if(urlParams.get('login') === 'success'){
                Swal.fire({
                    title: 'Tekrar HoÅŸ Geldin, <%= user.firstName %>! ðŸ‘‹',
                    text: 'Kariyer yolculuÄŸunda seni tekrar gÃ¶rmek harika.',
                    icon: 'success',
                    timer: 2500,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    background: '#fff',
                    backdrop: `rgba(0,0,123,0.1) left top no-repeat`
                });
                window.history.replaceState(null, null, window.location.pathname);
            }

            // POPUP UYARI (MESAJ VARSA)
            <% if (locals.unreadCount && locals.unreadCount > 0) { %>
                Swal.fire({
                    title: 'Yeni MesajÄ±n Var! ðŸ“¬',
                    text: 'DanÄ±ÅŸmanÄ±ndan <%= unreadCount %> adet yeni mesaj aldÄ±n.',
                    icon: 'info',
                    confirmButtonText: 'Mesajlara Git',
                    confirmButtonColor: '#4f46e5',
                    showCancelButton: true,
                    cancelButtonText: 'Kapat'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = '/messages';
                    }
                });
            <% } %>

            // --- HAVA DURUMU SÄ°STEMÄ° ---

            function getWeatherInfo(code) {
                if(code === 0) return { icon: 'fa-sun', color: 'text-warning', text: 'AÃ§Ä±k' };
                if([1,2,3].includes(code)) return { icon: 'fa-cloud-sun', color: 'text-warning', text: 'ParÃ§alÄ± Bulutlu' };
                if([45,48].includes(code)) return { icon: 'fa-smog', color: 'text-secondary', text: 'Sisli' };
                if([51,53,55,61,63,65].includes(code)) return { icon: 'fa-cloud-rain', color: 'text-info', text: 'YaÄŸmurlu' };
                if([71,73,75,77].includes(code)) return { icon: 'fa-snowflake', color: 'text-info', text: 'KarlÄ±' };
                if(code >= 95) return { icon: 'fa-bolt', color: 'text-danger', text: 'FÄ±rtÄ±na' };
                return { icon: 'fa-cloud', color: 'text-secondary', text: 'Bulutlu' };
            }

            function fetchWeather(lat, lon, elementId) {
                fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`)
                    .then(response => response.json())
                    .then(data => {
                        const info = getWeatherInfo(data.current_weather.weathercode);
                        const card = document.getElementById(elementId);
                        
                        if (card) {
                            card.querySelector('.weather-temp').innerText = `${Math.round(data.current_weather.temperature)}Â°`;
                            card.querySelector('.weather-desc').innerText = info.text;
                            
                            const iconDiv = card.querySelector('.weather-icon');
                            iconDiv.className = `weather-icon ${info.color} mb-0`;
                            iconDiv.innerHTML = `<i class="fas ${info.icon}"></i>`;
                        }
                    })
                    .catch(err => console.error('Hava durumu hatasÄ±:', err));
            }

            // GÃœVENLÄ° VERÄ° AKTARIMI
            const targetInfo = <%- JSON.stringify(locals.targetStateInfo || null) %>;

            if (targetInfo) {
                fetchWeather(targetInfo.lat, targetInfo.lon, 'target-state-weather');
            }

            const cities = [
                { id: 'berlin', lat: 52.52, lon: 13.41 },
                { id: 'hamburg', lat: 53.55, lon: 9.99 },
                { id: 'kiel', lat: 54.32, lon: 10.12 },
                { id: 'hannover', lat: 52.37, lon: 9.73 },
                { id: 'dortmund', lat: 51.51, lon: 7.46 },
                { id: 'gelsenkirchen', lat: 51.51, lon: 7.10 }
            ];

            cities.forEach(city => {
                fetchWeather(city.lat, city.lon, `weather-${city.id}`);
            });
        });
    </script>

</body>
</html>