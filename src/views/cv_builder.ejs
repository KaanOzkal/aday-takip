<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CV OluÅŸturucu | Almanya Kariyer</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        :root {
            --primary: #4f46e5;
            --bg-body: #f3f4f6;
            --surface: #ffffff;
            --border: #e5e7eb;
        }

        body {
            background-color: var(--bg-body);
            font-family: 'Inter', sans-serif;
            color: #1f2937;
            padding-bottom: 100px; /* Alt bar iÃ§in boÅŸluk */
        }

        /* -------------------------------------------
           RESPONSIVE AYARLAR
        ------------------------------------------- */
        
        /* 1. Navbar */
        .top-bar {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 1020;
        }

        /* 2. Kartlar (MasaÃ¼stÃ¼ vs Mobil) */
        .section-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px; /* MasaÃ¼stÃ¼ boÅŸluk */
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            scroll-margin-top: 90px;
        }

        /* MOBÄ°L Ä°Ã‡Ä°N Ã–ZEL AYARLAR (Ekran 992px'den kÃ¼Ã§Ã¼kse) */
        @media (max-width: 991.98px) {
            .section-card {
                padding: 20px; /* Mobilde daha dar boÅŸluk */
                border-radius: 12px;
            }
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            /* Mobilde baÅŸlÄ±klar kÃ¼Ã§Ã¼lsÃ¼n */
            h4, h5 { font-size: 1.1rem; }
        }

        /* 3. Sol MenÃ¼ (Sadece MasaÃ¼stÃ¼nde GÃ¶rÃ¼nÃ¼r) */
        .sidebar-menu {
            position: sticky;
            top: 90px;
        }
        .menu-link {
            display: block;
            padding: 10px 15px;
            color: #6b7280;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            margin-bottom: 5px;
            transition: 0.2s;
        }
        .menu-link:hover, .menu-link.active {
            background: #eef2ff;
            color: var(--primary);
        }
        .menu-link i { width: 20px; margin-right: 8px; }

        /* 4. FotoÄŸraf YÃ¼kleme AlanÄ± */
        .photo-uploader {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #f9fafb;
            border: 2px dashed #cbd5e1;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; overflow: hidden; position: relative;
            margin: 0 auto 15px auto; /* Mobilde ortala */
        }
        @media (min-width: 992px) {
            .photo-uploader { margin: 0 0 0 0; } /* MasaÃ¼stÃ¼nde sola yasla */
        }
        .photo-preview { width: 100%; height: 100%; object-fit: cover; }

        /* 5. Alt Aksiyon BarÄ± (Sticky Footer) */
        .action-bar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 12px 0;
            z-index: 1030;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
        }
        
        /* Floating Input DÃ¼zenlemesi */
        .form-floating > .form-control { border-radius: 10px; border-color: #e5e7eb; }
        .form-floating > .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2">
                <a href="/panel" class="text-dark text-decoration-none">
                    <i class="fas fa-arrow-left bg-light p-2 rounded-circle border"></i>
                </a>
                <h6 class="fw-bold mb-0">CV OluÅŸturucu</h6>
            </div>
            <span class="badge bg-success bg-opacity-10 text-success border border-success d-none d-sm-inline-block">Otomatik Taslak</span>
        </div>
    </div>

    <div class="container mt-4">
        <form action="/cv-builder/save" method="POST" enctype="multipart/form-data" id="mainForm">
            <div class="row">
                
                <div class="col-lg-3 d-none d-lg-block">
                    <div class="sidebar-menu">
                        <small class="text-uppercase text-muted fw-bold ps-3 mb-2 d-block" style="font-size: 0.7rem;">MENÃœ</small>
                        <a href="#sec-profile" class="menu-link active"><i class="fas fa-id-card"></i> Kimlik & Ä°letiÅŸim</a>
                        <a href="#sec-about" class="menu-link"><i class="fas fa-user"></i> HakkÄ±mda</a>
                        <a href="#sec-skills" class="menu-link"><i class="fas fa-star"></i> Yetenekler</a>
                        <a href="#sec-experience" class="menu-link"><i class="fas fa-briefcase"></i> Deneyim</a>
                        <a href="#sec-education" class="menu-link"><i class="fas fa-graduation-cap"></i> EÄŸitim</a>
                    </div>
                </div>

                <div class="col-12 col-lg-9">

                    <div id="sec-profile" class="section-card">
                        <div class="section-title fw-bold mb-4 border-bottom pb-2">
                            <i class="fas fa-id-card text-primary me-2"></i> Kimlik & Ä°letiÅŸim Bilgileri
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-auto text-center mb-4 mb-lg-0">
                                <input type="file" id="photoInput" name="photo" accept="image/*" hidden onchange="previewImage(this)">
                                <div class="photo-uploader shadow-sm" onclick="document.getElementById('photoInput').click()">
                                    <% if(user.cvDetails?.profilePhoto) { %>
                                        <img src="<%= user.cvDetails.profilePhoto %>" id="previewImg" class="photo-preview">
                                    <% } else { %>
                                        <div id="uploadPlaceholder" class="text-center text-muted">
                                            <i class="fas fa-camera fa-2x"></i>
                                        </div>
                                        <img src="" id="previewImg" class="photo-preview d-none">
                                    <% } %>
                                </div>
                                <div class="small text-muted fw-bold mt-2">Profil FotoÄŸrafÄ±</div>
                            </div>

                            <div class="col-lg ps-lg-4">
                                <div class="row g-3">
                                    <div class="col-12">
                                        <div class="form-floating">
                                            <input type="text" name="drivingLicense" class="form-control border-primary border-opacity-25" id="licenseInput" value="<%= user.cvDetails && user.cvDetails.drivingLicense ? user.cvDetails.drivingLicense : '' %>" placeholder="Ehliyet">
                                            <label class="text-primary fw-bold"><i class="fas fa-car me-1"></i> Ehliyet SÄ±nÄ±flarÄ± (Ã–rn: B, C, CE, SRC)</label>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="email" name="email" class="form-control" value="<%= user.cvDetails?.email || user.email %>" placeholder="Email">
                                            <label>E-Posta Adresi</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="tel" name="phone" class="form-control" value="<%= user.cvDetails?.phone || user.phone %>" placeholder="Telefon">
                                            <label>Telefon NumarasÄ±</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sec-about" class="section-card">
                        <div class="section-title fw-bold mb-3"><i class="fas fa-user-edit text-primary me-2"></i> KiÅŸisel Ã–zet</div>
                        <div class="form-floating">
                            <textarea name="summary" class="form-control" placeholder="Ã–zet" id="summaryBox" style="height: 120px"><%= user.cvDetails?.summary %></textarea>
                            <label for="summaryBox">Kendinizi kÄ±saca tanÄ±tÄ±n...</label>
                        </div>
                    </div>

                    <div id="sec-skills" class="section-card">
                        <div class="section-title fw-bold mb-3"><i class="fas fa-bolt text-warning me-2"></i> Yetkinlikler</div>
                        <div class="row g-3">
                            <div class="col-12 col-md-6">
                                <div class="form-floating">
                                    <input type="text" name="skills" class="form-control" id="skillsInput" value="<%= user.cvDetails?.skills %>" placeholder="Yetenekler">
                                    <label>Yetenekler (VirgÃ¼lle ayÄ±rÄ±n)</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6">
                                <div class="form-floating">
                                    <input type="text" name="languages" class="form-control" id="langInput" value="<%= user.cvDetails?.languages %>" placeholder="Diller">
                                    <label>Diller (Ã–rn: TÃ¼rkÃ§e, Almanca)</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sec-experience" class="section-card">
                        <div class="section-title fw-bold mb-3"><i class="fas fa-briefcase text-success me-2"></i> Ä°ÅŸ Deneyimi</div>
                        
                        <div class="bg-light p-3 rounded-3 mb-3 border">
                            <h6 class="fw-bold small text-muted mb-2">SON Ä°ÅžYERÄ°</h6>
                            <div class="row g-2">
                                <div class="col-12 col-md-6">
                                    <div class="form-floating">
                                        <input type="text" name="exp1_title" class="form-control" value="<%= user.cvDetails?.experience1?.title %>" placeholder="Pozisyon">
                                        <label>Pozisyon AdÄ±</label>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="form-floating">
                                        <input type="text" name="exp1_company" class="form-control" value="<%= user.cvDetails?.experience1?.company %>" placeholder="Åžirket">
                                        <label>Åžirket AdÄ±</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-floating">
                                        <input type="text" name="exp1_date" class="form-control" value="<%= user.cvDetails?.experience1?.date %>" placeholder="Tarih">
                                        <label>Tarih (YÄ±l)</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-floating">
                                        <textarea name="exp1_desc" class="form-control" style="height: 80px" placeholder="AÃ§Ä±klama"><%= user.cvDetails?.experience1?.desc %></textarea>
                                        <label>Ä°ÅŸ TanÄ±mÄ±</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-light p-3 rounded-3 border">
                            <h6 class="fw-bold small text-muted mb-2">Ã–NCEKÄ° Ä°ÅžYERÄ° (OPSÄ°YONEL)</h6>
                            <div class="row g-2">
                                <div class="col-12 col-md-6">
                                    <div class="form-floating">
                                        <input type="text" name="exp2_title" class="form-control" value="<%= user.cvDetails?.experience2?.title %>" placeholder="Pozisyon">
                                        <label>Pozisyon AdÄ±</label>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <div class="form-floating">
                                        <input type="text" name="exp2_company" class="form-control" value="<%= user.cvDetails?.experience2?.company %>" placeholder="Åžirket">
                                        <label>Åžirket AdÄ±</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-floating">
                                        <input type="text" name="exp2_date" class="form-control" value="<%= user.cvDetails?.experience2?.date %>" placeholder="Tarih">
                                        <label>Tarih (YÄ±l)</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-floating">
                                        <textarea name="exp2_desc" class="form-control" style="height: 80px" placeholder="AÃ§Ä±klama"><%= user.cvDetails?.experience2?.desc %></textarea>
                                        <label>Ä°ÅŸ TanÄ±mÄ±</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sec-education" class="section-card">
                        <div class="section-title fw-bold mb-3"><i class="fas fa-graduation-cap text-danger me-2"></i> EÄŸitim</div>
                        <div class="row g-2">
                            <div class="col-12">
                                <div class="form-floating">
                                    <input type="text" name="edu1_school" class="form-control" value="<%= user.cvDetails?.education1?.school %>" placeholder="Okul">
                                    <label>Okul AdÄ±</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-floating">
                                    <input type="text" name="edu1_degree" class="form-control" value="<%= user.cvDetails?.education1?.degree %>" placeholder="BÃ¶lÃ¼m">
                                    <label>BÃ¶lÃ¼m/Derece</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-floating">
                                    <input type="text" name="edu1_date" class="form-control" value="<%= user.cvDetails?.education1?.date %>" placeholder="YÄ±l">
                                    <label>Mezuniyet YÄ±lÄ±</label>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </form>
    </div>

    <div class="action-bar">
        <div class="container">
            <div class="d-flex gap-2">
                <a href="/cv-print" target="_blank" class="btn btn-outline-dark fw-bold flex-grow-1">
                    <i class="fas fa-eye me-1"></i> Ã–nizle
                </a>
                <button type="button" onclick="submitForm()" class="btn btn-primary fw-bold flex-grow-1">
                    <i class="fas fa-save me-1"></i> Kaydet
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // FotoÄŸraf Ã–nizleme
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('previewImg').classList.remove('d-none');
                    const placeholder = document.getElementById('uploadPlaceholder');
                    if(placeholder) placeholder.classList.add('d-none');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Form GÃ¶nderme
        function submitForm() {
            Swal.fire({
                title: 'Kaydediliyor...',
                text: 'LÃ¼tfen bekleyin.',
                didOpen: () => { Swal.showLoading() },
                background: '#fff',
                color: '#333',
                showConfirmButton: false
            });
            document.getElementById('mainForm').submit();
        }

        // BaÅŸarÄ± MesajÄ±
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('status') === 'saved'){
            Swal.fire({
                icon: 'success',
                title: 'Kaydedildi!',
                text: 'CV bilgileriniz gÃ¼ncellendi.',
                timer: 1500,
                showConfirmButton: false,
                position: 'top-end',
                toast: true
            });
            window.history.replaceState(null, null, window.location.pathname);
        }

        // --- POPUP UYARI SCRIPT ---
        document.addEventListener('DOMContentLoaded', function() {
            if (!sessionStorage.getItem('cv_info_shown')) {
                Swal.fire({
                    title: 'ðŸ‘‹ HoÅŸ Geldiniz!',
                    html: `
                        <div style="text-align: left; font-size: 0.9rem;">
                            <p class="mb-2">Profesyonel CV'nizi buradan oluÅŸturabilirsiniz.</p>
                            <div class="alert alert-success py-2 px-3 mb-2 small">
                                <strong>AdÄ±mlar:</strong>
                            </div>
                            <ol class="small mb-0 ps-3">
                                <li>Bilgileri doldurup <b>Kaydet</b>'e basÄ±n.</li>
                                <li><b>Ã–nizle</b> ile PDF indirin.</li>
                                <li><b>DokÃ¼manlar</b> sayfasÄ±na yÃ¼kleyin.</li>
                            </ol>
                        </div>
                    `,
                    icon: 'info',
                    confirmButtonText: 'TamamdÄ±r',
                    confirmButtonColor: '#4f46e5',
                    backdrop: `rgba(0,0,0,0.5)`
                }).then(() => {
                    sessionStorage.setItem('cv_info_shown', 'true');
                });
            }
        });

        // Scroll Spy (Sadece Desktop)
        window.addEventListener('scroll', () => {
            if(window.innerWidth > 991) {
                const sections = document.querySelectorAll('.section-card');
                const navLi = document.querySelectorAll('.menu-link');
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 150) current = section.getAttribute('id');
                });
                navLi.forEach(li => {
                    li.classList.remove('active');
                    if (li.getAttribute('href').includes(current)) li.classList.add('active');
                });
            }
        });
    </script>

</body>
</html>